## Общие сведения

Стек - это <font color="#ffff00">область памяти</font>, на которую указывает [[Регистр]] <font color="#ff0000">RSP</font>(register stack pointer) из [[Регистры архитектуры x86]]. 

![[Pasted image 20250526225012.png]]

В архитектуре [[x86]] <font color="#ffff00">стек растёт вниз</font>, т.е. значения, которые хранятся дольше находятся в адресах, которые больше, чем адреса для новых значений.

## Взаимодействие со стеком

Для взаимодействия со стеком используются следующие команды:
1. pushq - для добавления элемента в стек
2. popq - для снятия последнего элемента со стека
3. movq с разыменованием.
## Команда pushq

### Описание работы

При вызове команды `pushq` <font color="#ffff00">регистр RSP сдвигается на 8 бит вниз(т.е. уменьшается)</font>, после чего по адресу RSP добавляется значение, которое мы передаём согласно синтаксису команды.
<font color="#ffff00">Синтаксис</font> у команды `pushq` следующий: `pushq <src>`, мы передаём в `<src>` значение, которое мы хотим положить на стек.
![[Pasted image 20250526230323.png]]
### Примеры использования

```x86
pushq $123123 - добавляем в стек литерал 123123
pushq %RAX - добавляем в стек значение находящееся в регистре %RAX
```

## Команда popq

### Описание работы

При вызове команды `popq` <font color="#ffff00">регистр RSP сдвигается на 8 бит вверх</font>(т.е. увеличивется), перед этим достав значение из регистра RSP и положив его в операнд переданный команде, который мы передаём согласно синтаксису команды.
<font color="#ffff00">Синтаксис </font>у команды `popq` следующий: `popq <dst>`, мы передаём в `<dst>` регистр/адрес памяти, в который мы хотим положить значение из стека.
![[Pasted image 20250526231043.png]]
### Примеры использования

```x86
popq %RAX - добавляем в стек значение находящееся в регистре %RAX
```
## Команда movq

Команда `movq` подробно описана в [[Инструкции копирования]]. <font color="#ffff00">Для копирования данных из стека без сдвига регистра</font> мы можем использовать команду `movq` следующим образом.

```x86
movq (%RSP), %R8
```

После чего значение с верхушки стека будет скопировано в регистр `%R8`.
#stack #operational_systems #assembler 